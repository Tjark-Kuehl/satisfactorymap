<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Satisfactory Map Debug</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { margin: 0; padding: 0; }
        #map { width: 100vw; height: 100vh; }
        #coords { position: absolute; bottom: 10px; left: 10px; background: white; padding: 5px; z-index: 1000; }
        .control-panel { 
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 10px;
            z-index: 1000;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
        }
        button { margin: 5px; padding: 5px 10px; }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="coords">Coordinates will appear here</div>
    <div class="control-panel">
        <h3>Debug Controls</h3>
        <button id="add-grid">Show Grid</button>
        <button id="add-test-points">Show Test Points</button>
        <div id="status"></div>
    </div>
    
    <script>
        // Initialize map
        const map = L.map('map', {
            crs: L.CRS.Simple,
            minZoom: -8,
            maxZoom: -3,
            zoomControl: true,
            attributionControl: false
        });
        
        // Set map bounds - using exact Satisfactory world size
        const bounds = [
            [-500000, -500000],  // Bottom left
            [500000, 500000]     // Top right
        ];
        
        // Add map image
        const mapImage = L.imageOverlay('/public/assets/Map.webp', bounds);
        mapImage.addTo(map);
        
        // Set initial view and bounds
        map.setView([0, 0], -6);
        map.setMaxBounds(bounds);
        
        // Show coordinates
        const coordsDisplay = document.getElementById('coords');
        const statusDisplay = document.getElementById('status');
        
        map.on('mousemove', (e) => {
            const x = Math.floor(e.latlng.lng);
            const y = Math.floor(e.latlng.lat);
            coordsDisplay.textContent = `X: ${x} | Y: ${y}`;
        });
        
        // Add test points button
        document.getElementById('add-test-points').addEventListener('click', addTestPoints);
        
        // Add grid button
        document.getElementById('add-grid').addEventListener('click', addGrid);
        
        // Grid layer
        let gridLayer = null;
        
        // Function to add grid
        function addGrid() {
            if (gridLayer) {
                map.removeLayer(gridLayer);
                gridLayer = null;
                statusDisplay.textContent = "Grid removed";
                return;
            }
            
            statusDisplay.textContent = "Adding grid...";
            
            // Create a grid
            gridLayer = L.layerGroup().addTo(map);
            
            // Add grid lines every 100,000 units
            const gridSpacing = 100000;
            
            // Add vertical lines
            for (let x = -500000; x <= 500000; x += gridSpacing) {
                const line = L.polyline([[-500000, x], [500000, x]], {
                    color: '#ff0000',
                    weight: 1,
                    opacity: 0.5
                }).addTo(gridLayer);
                
                // Add label
                L.marker([0, x], {
                    icon: L.divIcon({
                        className: 'grid-label',
                        html: `${x}`,
                        iconSize: [40, 20]
                    })
                }).addTo(gridLayer);
            }
            
            // Add horizontal lines
            for (let y = -500000; y <= 500000; y += gridSpacing) {
                const line = L.polyline([[y, -500000], [y, 500000]], {
                    color: '#0000ff',
                    weight: 1,
                    opacity: 0.5
                }).addTo(gridLayer);
                
                // Add label
                L.marker([y, 0], {
                    icon: L.divIcon({
                        className: 'grid-label',
                        html: `${y}`,
                        iconSize: [40, 20]
                    })
                }).addTo(gridLayer);
            }
            
            statusDisplay.textContent = "Grid added";
        }
        
        // Test points layer
        let testPointsLayer = null;
        
        // Function to add test points
        function addTestPoints() {
            if (testPointsLayer) {
                map.removeLayer(testPointsLayer);
                testPointsLayer = null;
                statusDisplay.textContent = "Test points removed";
                return;
            }
            
            statusDisplay.textContent = "Adding test points...";
            
            // Create a layer for test points
            testPointsLayer = L.layerGroup().addTo(map);
            
            // Define test points - coordinates are exact game coordinates
            const testPoints = [
                { x: 0, y: 0, name: "Center" },
                { x: 100000, y: 100000, name: "NE 100k" },
                { x: -100000, y: 100000, name: "NW 100k" },
                { x: 100000, y: -100000, name: "SE 100k" },
                { x: -100000, y: -100000, name: "SW 100k" },
                { x: 250000, y: 250000, name: "NE 250k" },
                { x: -250000, y: 250000, name: "NW 250k" },
                { x: 250000, y: -250000, name: "SE 250k" },
                { x: -250000, y: -250000, name: "SW 250k" },
                { x: 400000, y: 400000, name: "NE 400k" },
                { x: -400000, y: 400000, name: "NW 400k" },
                { x: 400000, y: -400000, name: "SE 400k" },
                { x: -400000, y: -400000, name: "SW 400k" }
            ];
            
            // Add each test point to the map
            testPoints.forEach(point => {
                // In Leaflet, Y axis increases northwards, but in game Y increases southwards
                // So we invert the Y coordinate
                const leafletY = -point.y;
                const leafletX = point.x;
                
                // Create a marker
                const marker = L.marker([leafletY, leafletX], {
                    icon: L.divIcon({
                        className: 'test-point',
                        html: `<div style="background-color: red; width: 10px; height: 10px; border-radius: 50%;"></div>`,
                        iconSize: [10, 10],
                        iconAnchor: [5, 5]
                    })
                }).addTo(testPointsLayer);
                
                // Add a popup with information
                marker.bindPopup(`
                    <b>${point.name}</b><br>
                    Game Coords: X: ${point.x}, Y: ${point.y}<br>
                    Leaflet Coords: X: ${leafletX}, Y: ${leafletY}
                `);
            });
            
            statusDisplay.textContent = `Added ${testPoints.length} test points`;
        }
    </script>
</body>
</html>
