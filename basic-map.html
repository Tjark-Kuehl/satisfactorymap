<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basic Map Test</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { margin: 0; padding: 0; }
        #map { width: 100vw; height: 100vh; }
        .control-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 10px;
            z-index: 1000;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
        }
        #coords { position: absolute; bottom: 10px; left: 10px; background: white; padding: 5px; z-index: 1000; }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="coords">Coordinates will appear here</div>
    <div class="control-panel">
        <h3>Basic Map Controls</h3>
        <button id="add-markers">Add Test Markers</button>
        <button id="load-resources">Load Resources</button>
        <div id="status"></div>
    </div>

    <script>
        // Initialize map
        const map = L.map('map', {
            crs: L.CRS.Simple,
            minZoom: -8,
            maxZoom: -3,
            zoomControl: true,
            attributionControl: false
        });
        
        // Set map bounds
        const bounds = [
            [-500000, -500000],  // Bottom left
            [500000, 500000]     // Top right
        ];
        
        // Add map image
        const mapImage = L.imageOverlay('/public/assets/Map.webp', bounds);
        mapImage.addTo(map);
        
        // Set initial view and bounds
        map.setView([0, 0], -6);
        map.setMaxBounds(bounds);
        
        // Show coordinates
        const coordsDisplay = document.getElementById('coords');
        const statusDisplay = document.getElementById('status');
        
        map.on('mousemove', (e) => {
            const x = Math.floor(e.latlng.lng);
            const y = Math.floor(e.latlng.lat);
            coordsDisplay.textContent = `X: ${x} | Y: ${y}`;
        });
        
        // Add test markers button
        document.getElementById('add-markers').addEventListener('click', addTestMarkers);
        
        // Load resources button
        document.getElementById('load-resources').addEventListener('click', loadResources);
        
        // Function to add test markers
        function addTestMarkers() {
            statusDisplay.textContent = "Adding test markers...";
            
            // Add basic markers at different positions
            [
                [0, 0, "Center"],
                [100000, 100000, "NE 100k"],
                [-100000, 100000, "NW 100k"],
                [100000, -100000, "SE 100k"],
                [-100000, -100000, "SW 100k"]
            ].forEach(([x, y, name]) => {
                // Invert Y for Leaflet
                const leafletY = -y;
                const leafletX = x;
                
                // Create marker
                const marker = L.marker([leafletY, leafletX]).addTo(map);
                marker.bindPopup(`<b>${name}</b><br>Game: ${x}, ${y}`);
            });
            
            statusDisplay.textContent = "Test markers added!";
        }
        
        // Function to load resources
        async function loadResources() {
            statusDisplay.textContent = "Loading resources...";
            
            try {
                const response = await fetch('/public/data/resources.json');
                if (!response.ok) {
                    throw new Error(`HTTP error: ${response.status}`);
                }
                
                const data = await response.json();
                statusDisplay.textContent = "Processing resources...";
                
                // Count total markers
                let totalMarkers = 0;
                
                // Process categories
                if (data && data.options) {
                    data.options.forEach(category => {
                        if (category && category.options) {
                            category.options.forEach(subCategory => {
                                if (subCategory && subCategory.options) {
                                    subCategory.options.forEach(resourceType => {
                                        // Get resources
                                        const resources = resourceType.resources || [];
                                        
                                        if (resources.length > 0) {
                                            // Add the first 5 resources of each type (to avoid overloading)
                                            const limit = Math.min(5, resources.length);
                                            
                                            for (let i = 0; i < limit; i++) {
                                                const resource = resources[i];
                                                
                                                // Check coordinates
                                                if (resource.x !== undefined && resource.y !== undefined) {
                                                    // Invert Y for Leaflet
                                                    const leafletY = -resource.y;
                                                    const leafletX = resource.x;
                                                    
                                                    // Create basic marker
                                                    const marker = L.marker([leafletY, leafletX]).addTo(map);
                                                    marker.bindPopup(`
                                                        <b>${resourceType.name || 'Unknown'}</b><br>
                                                        Location: ${resource.x}, ${resource.y}
                                                    `);
                                                    
                                                    totalMarkers++;
                                                }
                                            }
                                        }
                                    });
                                }
                            });
                        }
                    });
                }
                
                statusDisplay.textContent = `Added ${totalMarkers} resource markers!`;
            } catch (error) {
                statusDisplay.textContent = `Error: ${error.message}`;
                console.error('Error loading resources:', error);
            }
        }
    </script>
</body>
</html>
